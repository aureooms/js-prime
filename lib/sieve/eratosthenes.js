'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});
exports.__eratosthenes__ = __eratosthenes__;

var _ = require('./');

/**
 * Sieve of Eratosthenes.
 */

function __eratosthenes__(alloc, fill, get, gothrough, usqrt) {

	var first = 2;

	var eratosthenes = function eratosthenes(n, callback) {

		var size, sieve, m, i, p;

		if (n <= 2) {
			return null;
		}

		size = (0, _.ptoi)(n);

		sieve = alloc(size);
		fill(sieve, 0, size, true);

		m = (0, _.ptoi)(usqrt(n));

		for (i = (0, _.ptoi)(first); i < m; ++i) {
			if (get(sieve, i)) {
				p = (0, _.itop)(i);
				callback(p);
				gothrough(sieve, (0, _.ptoi)(p * p), size, p);
			}
		}

		for (i = m; i < size; ++i) {
			if (get(sieve, i)) {
				callback((0, _.itop)(i));
			}
		}

		return sieve;
	};

	return eratosthenes;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zaWV2ZS9lcmF0b3N0aGVuZXMuanMiXSwibmFtZXMiOlsiX19lcmF0b3N0aGVuZXNfXyIsImFsbG9jIiwiZmlsbCIsImdldCIsImdvdGhyb3VnaCIsInVzcXJ0IiwiZmlyc3QiLCJlcmF0b3N0aGVuZXMiLCJuIiwiY2FsbGJhY2siLCJzaXplIiwic2lldmUiLCJtIiwiaSIsInAiXSwibWFwcGluZ3MiOiI7Ozs7O1FBTWdCQSxnQixHQUFBQSxnQjs7QUFOaEI7O0FBRUE7Ozs7QUFJTyxTQUFTQSxnQkFBVCxDQUE0QkMsS0FBNUIsRUFBb0NDLElBQXBDLEVBQTJDQyxHQUEzQyxFQUFpREMsU0FBakQsRUFBNkRDLEtBQTdELEVBQXFFOztBQUUzRSxLQUFJQyxRQUFRLENBQVo7O0FBRUEsS0FBSUMsZUFBZSxTQUFmQSxZQUFlLENBQVdDLENBQVgsRUFBZUMsUUFBZixFQUEwQjs7QUFFNUMsTUFBSUMsSUFBSixFQUFXQyxLQUFYLEVBQW1CQyxDQUFuQixFQUF1QkMsQ0FBdkIsRUFBMkJDLENBQTNCOztBQUVBLE1BQUtOLEtBQUssQ0FBVixFQUFjO0FBQ2IsVUFBTyxJQUFQO0FBQ0E7O0FBRURFLFNBQU8sWUFBTUYsQ0FBTixDQUFQOztBQUVBRyxVQUFRVixNQUFPUyxJQUFQLENBQVI7QUFDQVIsT0FBTVMsS0FBTixFQUFjLENBQWQsRUFBa0JELElBQWxCLEVBQXlCLElBQXpCOztBQUVBRSxNQUFJLFlBQU1QLE1BQU9HLENBQVAsQ0FBTixDQUFKOztBQUVBLE9BQU1LLElBQUksWUFBTVAsS0FBTixDQUFWLEVBQTBCTyxJQUFJRCxDQUE5QixFQUFrQyxFQUFFQyxDQUFwQyxFQUF3QztBQUN2QyxPQUFLVixJQUFLUSxLQUFMLEVBQWFFLENBQWIsQ0FBTCxFQUF3QjtBQUN2QkMsUUFBSSxZQUFNRCxDQUFOLENBQUo7QUFDQUosYUFBVUssQ0FBVjtBQUNBVixjQUFXTyxLQUFYLEVBQW1CLFlBQU1HLElBQUlBLENBQVYsQ0FBbkIsRUFBbUNKLElBQW5DLEVBQTBDSSxDQUExQztBQUNBO0FBQ0Q7O0FBRUQsT0FBTUQsSUFBSUQsQ0FBVixFQUFjQyxJQUFJSCxJQUFsQixFQUF5QixFQUFFRyxDQUEzQixFQUErQjtBQUM5QixPQUFLVixJQUFLUSxLQUFMLEVBQWFFLENBQWIsQ0FBTCxFQUF3QjtBQUN2QkosYUFBVSxZQUFNSSxDQUFOLENBQVY7QUFDQTtBQUNEOztBQUVELFNBQU9GLEtBQVA7QUFDQSxFQTlCRDs7QUFnQ0EsUUFBT0osWUFBUDtBQUVBIiwiZmlsZSI6ImVyYXRvc3RoZW5lcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHB0b2kgLCBpdG9wIH0gZnJvbSAnLi8nIDtcblxuLyoqXG4gKiBTaWV2ZSBvZiBFcmF0b3N0aGVuZXMuXG4gKi9cblxuZXhwb3J0IGZ1bmN0aW9uIF9fZXJhdG9zdGhlbmVzX18gKCBhbGxvYyAsIGZpbGwgLCBnZXQgLCBnb3Rocm91Z2ggLCB1c3FydCApIHtcblxuXHR2YXIgZmlyc3QgPSAyIDtcblxuXHR2YXIgZXJhdG9zdGhlbmVzID0gZnVuY3Rpb24gKCBuICwgY2FsbGJhY2sgKSB7XG5cblx0XHR2YXIgc2l6ZSAsIHNpZXZlICwgbSAsIGkgLCBwIDtcblxuXHRcdGlmICggbiA8PSAyICkge1xuXHRcdFx0cmV0dXJuIG51bGwgO1xuXHRcdH1cblxuXHRcdHNpemUgPSBwdG9pKCBuICkgO1xuXG5cdFx0c2lldmUgPSBhbGxvYyggc2l6ZSApIDtcblx0XHRmaWxsKCBzaWV2ZSAsIDAgLCBzaXplICwgdHJ1ZSApIDtcblxuXHRcdG0gPSBwdG9pKCB1c3FydCggbiApICkgO1xuXG5cdFx0Zm9yICggaSA9IHB0b2koIGZpcnN0ICkgOyBpIDwgbSA7ICsraSApIHtcblx0XHRcdGlmICggZ2V0KCBzaWV2ZSAsIGkgKSApIHtcblx0XHRcdFx0cCA9IGl0b3AoIGkgKSA7XG5cdFx0XHRcdGNhbGxiYWNrKCBwICkgO1xuXHRcdFx0XHRnb3Rocm91Z2goIHNpZXZlICwgcHRvaSggcCAqIHAgKSAsIHNpemUgLCBwICkgO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGZvciAoIGkgPSBtIDsgaSA8IHNpemUgOyArK2kgKSB7XG5cdFx0XHRpZiAoIGdldCggc2lldmUgLCBpICkgKSB7XG5cdFx0XHRcdGNhbGxiYWNrKCBpdG9wKCBpICkgKSA7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHNpZXZlIDtcblx0fSA7XG5cblx0cmV0dXJuIGVyYXRvc3RoZW5lcyA7XG5cbn1cbiJdfQ==