'use strict';

Object.defineProperty(exports, "__esModule", {
	value: true
});
exports.__eratosthenes2__ = __eratosthenes2__;

var _ = require('./');

/**
 * Sieve of Eratosthenes skipping all multiples of 2.
 */

function __eratosthenes2__(alloc, fill, get, gothrough, usqrt) {

	var first = 3;

	var eratosthenes2 = function eratosthenes2(n, callback) {

		var size, sieve, m, i, p;

		if (n <= 2) {
			return null;
		}

		callback(2);

		if (n <= 3) {
			return null;
		}

		size = (0, _.ptoi2)(n);

		sieve = alloc(size);
		fill(sieve, 0, size, true);

		m = (0, _.ptoi2)(usqrt(n));

		for (i = (0, _.ptoi2)(first); i < m; ++i) {
			if (get(sieve, i)) {
				p = (0, _.itop2)(i);
				callback(p);
				gothrough(sieve, (0, _.ptoi2)(p * p), size, p);
			}
		}

		for (i = m; i < size; ++i) {
			if (get(sieve, i)) {
				callback((0, _.itop2)(i));
			}
		}

		return sieve;
	};

	return eratosthenes2;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zaWV2ZS9lcmF0b3N0aGVuZXMyLmpzIl0sIm5hbWVzIjpbIl9fZXJhdG9zdGhlbmVzMl9fIiwiYWxsb2MiLCJmaWxsIiwiZ2V0IiwiZ290aHJvdWdoIiwidXNxcnQiLCJmaXJzdCIsImVyYXRvc3RoZW5lczIiLCJuIiwiY2FsbGJhY2siLCJzaXplIiwic2lldmUiLCJtIiwiaSIsInAiXSwibWFwcGluZ3MiOiI7Ozs7O1FBS2dCQSxpQixHQUFBQSxpQjs7QUFMaEI7O0FBQ0E7Ozs7QUFJTyxTQUFTQSxpQkFBVCxDQUE2QkMsS0FBN0IsRUFBcUNDLElBQXJDLEVBQTRDQyxHQUE1QyxFQUFrREMsU0FBbEQsRUFBOERDLEtBQTlELEVBQXNFOztBQUU1RSxLQUFJQyxRQUFRLENBQVo7O0FBRUEsS0FBSUMsZ0JBQWdCLFNBQWhCQSxhQUFnQixDQUFXQyxDQUFYLEVBQWVDLFFBQWYsRUFBMEI7O0FBRTdDLE1BQUlDLElBQUosRUFBV0MsS0FBWCxFQUFtQkMsQ0FBbkIsRUFBdUJDLENBQXZCLEVBQTJCQyxDQUEzQjs7QUFFQSxNQUFLTixLQUFLLENBQVYsRUFBYztBQUNiLFVBQU8sSUFBUDtBQUNBOztBQUVEQyxXQUFVLENBQVY7O0FBRUEsTUFBS0QsS0FBSyxDQUFWLEVBQWM7QUFDYixVQUFPLElBQVA7QUFDQTs7QUFFREUsU0FBTyxhQUFPRixDQUFQLENBQVA7O0FBRUFHLFVBQVFWLE1BQU9TLElBQVAsQ0FBUjtBQUNBUixPQUFNUyxLQUFOLEVBQWMsQ0FBZCxFQUFrQkQsSUFBbEIsRUFBeUIsSUFBekI7O0FBRUFFLE1BQUksYUFBT1AsTUFBT0csQ0FBUCxDQUFQLENBQUo7O0FBRUEsT0FBTUssSUFBSSxhQUFPUCxLQUFQLENBQVYsRUFBMkJPLElBQUlELENBQS9CLEVBQW1DLEVBQUVDLENBQXJDLEVBQXlDO0FBQ3hDLE9BQUtWLElBQUtRLEtBQUwsRUFBYUUsQ0FBYixDQUFMLEVBQXdCO0FBQ3ZCQyxRQUFJLGFBQU9ELENBQVAsQ0FBSjtBQUNBSixhQUFVSyxDQUFWO0FBQ0FWLGNBQVdPLEtBQVgsRUFBbUIsYUFBT0csSUFBSUEsQ0FBWCxDQUFuQixFQUFvQ0osSUFBcEMsRUFBMkNJLENBQTNDO0FBQ0E7QUFDRDs7QUFFRCxPQUFNRCxJQUFJRCxDQUFWLEVBQWNDLElBQUlILElBQWxCLEVBQXlCLEVBQUVHLENBQTNCLEVBQStCO0FBQzlCLE9BQUtWLElBQUtRLEtBQUwsRUFBYUUsQ0FBYixDQUFMLEVBQXdCO0FBQ3ZCSixhQUFVLGFBQU9JLENBQVAsQ0FBVjtBQUNBO0FBQ0Q7O0FBRUQsU0FBT0YsS0FBUDtBQUNBLEVBcENEOztBQXNDQSxRQUFPSixhQUFQO0FBRUEiLCJmaWxlIjoiZXJhdG9zdGhlbmVzMi5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHB0b2kyICwgaXRvcDIgfSBmcm9tICcuLycgO1xuLyoqXG4gKiBTaWV2ZSBvZiBFcmF0b3N0aGVuZXMgc2tpcHBpbmcgYWxsIG11bHRpcGxlcyBvZiAyLlxuICovXG5cbmV4cG9ydCBmdW5jdGlvbiBfX2VyYXRvc3RoZW5lczJfXyAoIGFsbG9jICwgZmlsbCAsIGdldCAsIGdvdGhyb3VnaCAsIHVzcXJ0ICkge1xuXG5cdHZhciBmaXJzdCA9IDMgO1xuXG5cdHZhciBlcmF0b3N0aGVuZXMyID0gZnVuY3Rpb24gKCBuICwgY2FsbGJhY2sgKSB7XG5cblx0XHR2YXIgc2l6ZSAsIHNpZXZlICwgbSAsIGkgLCBwIDtcblxuXHRcdGlmICggbiA8PSAyICkge1xuXHRcdFx0cmV0dXJuIG51bGwgO1xuXHRcdH1cblxuXHRcdGNhbGxiYWNrKCAyICkgO1xuXG5cdFx0aWYgKCBuIDw9IDMgKSB7XG5cdFx0XHRyZXR1cm4gbnVsbCA7XG5cdFx0fVxuXG5cdFx0c2l6ZSA9IHB0b2kyKCBuICkgO1xuXG5cdFx0c2lldmUgPSBhbGxvYyggc2l6ZSApIDtcblx0XHRmaWxsKCBzaWV2ZSAsIDAgLCBzaXplICwgdHJ1ZSApIDtcblxuXHRcdG0gPSBwdG9pMiggdXNxcnQoIG4gKSApIDtcblxuXHRcdGZvciAoIGkgPSBwdG9pMiggZmlyc3QgKSA7IGkgPCBtIDsgKytpICkge1xuXHRcdFx0aWYgKCBnZXQoIHNpZXZlICwgaSApICkge1xuXHRcdFx0XHRwID0gaXRvcDIoIGkgKSA7XG5cdFx0XHRcdGNhbGxiYWNrKCBwICkgO1xuXHRcdFx0XHRnb3Rocm91Z2goIHNpZXZlICwgcHRvaTIoIHAgKiBwICkgLCBzaXplICwgcCApIDtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRmb3IgKCBpID0gbSA7IGkgPCBzaXplIDsgKytpICkge1xuXHRcdFx0aWYgKCBnZXQoIHNpZXZlICwgaSApICkge1xuXHRcdFx0XHRjYWxsYmFjayggaXRvcDIoIGkgKSApIDtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gc2lldmUgO1xuXHR9IDtcblxuXHRyZXR1cm4gZXJhdG9zdGhlbmVzMiA7XG5cbn1cbiJdfQ==