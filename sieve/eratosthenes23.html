<!DOCTYPE html><html lang="en"><head><title>sieve/eratosthenes23</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="sieve/eratosthenes23"><meta name="groc-project-path" content="js/src/sieve/eratosthenes23.js"><meta name="groc-github-url" content="https://github.com/aureooms/js-prime"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/aureooms/js-prime/blob/master/js/src/sieve/eratosthenes23.js">js/src/sieve/eratosthenes23.js</a></div></div><div id="document"><div class="segment"></div><div class="segment"><div class="comments "><div class="wrapper"><p>Sieve of Eratosthenes skipping all multiples of 2 and 3.</p>
<p>5 7 11 13 17 19 23 25 29 31 35 37 41 43 47 49 53 55 59 61 65 67 71 73 77 79
0 1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25</p>
<p>83 85 89 91 95 97 101 103 107 109 113 115 119 121 125 127 131 133 137 139
26 27 28 29 30 31  32  33  34  35  36  37  38  39  40  41  42  43  44  45</p>
<p>143 145 149 151 155 157 161 163 167 169 173 175 179 181 185 187 191
 46  47  48  49  50  51  52  53  54  55  56  57  58  59  60  61  62</p>
<p>i( 5) = 0
i(25) = 7
i(35) = 10 = 7 + 5 - 2</p>
<p>i( 7) = 1
i(49) = 15
i(77) = 24 = 15 + 7 + 2</p>
<p>i( 11) = 2
i(121) = 39
i(143) = 46 = 39 + 11 - 4</p>
<p>i( 13) = 3
i(139) = 45
i(191) = 62 = 45 + 13 + 4</p></div></div><div class="code"><div class="wrapper"><span class="hljs-keyword">var</span> __eratosthenes23__ = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( alloc , fill , get , gothrough , usqrt )</span> {</span>

	<span class="hljs-keyword">var</span> first = <span class="hljs-number">5</span> ;

	<span class="hljs-keyword">var</span> eratosthenes23 = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">( n , callback )</span> {</span>

		<span class="hljs-keyword">var</span> size , sieve , m , i , j , p , l ;

		<span class="hljs-keyword">if</span> ( n &lt;= <span class="hljs-number">2</span> ) {
			<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span> ;
		}

		callback( <span class="hljs-number">2</span> ) ;

		<span class="hljs-keyword">if</span> ( n &lt;= <span class="hljs-number">3</span> ) {
			<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span> ;
		}

		callback( <span class="hljs-number">3</span> ) ;

		<span class="hljs-keyword">if</span> ( n &lt;= <span class="hljs-number">5</span> ) {
			<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span> ;
		}

		size = ptoi23( n ) ;

		sieve = alloc( size ) ;
		fill( sieve , <span class="hljs-number">0</span> , size , <span class="hljs-literal">true</span> ) ;

		m = ptoi23( usqrt( n ) ) ;
		i = ptoi230( first ) ;

		<span class="hljs-keyword">for</span> ( l = <span class="hljs-number">2</span> ; ; l += <span class="hljs-number">2</span> ) {

			<span class="hljs-keyword">if</span> ( i &gt;= m ) {
				<span class="hljs-keyword">break</span> ;
			}

			<span class="hljs-keyword">if</span> ( get( sieve , i ) ) {

				p = itop230( i ) ;

				callback( p ) ;

				j = ptoi231( p * p ) ;

				gothrough( sieve , j , size , <span class="hljs-number">2</span> * p ) ;
				gothrough( sieve , j + p - l , size , <span class="hljs-number">2</span> * p ) ;

			}

			++i ;


			<span class="hljs-keyword">if</span> ( i &gt;= m ) {
				<span class="hljs-keyword">break</span> ;
			}

			<span class="hljs-keyword">if</span> ( get( sieve , i ) ) {

				p = itop231( i ) ;

				callback( p ) ;

				j = ptoi231( p * p ) ;

				gothrough( sieve , j , size , <span class="hljs-number">2</span> * p ) ;
				gothrough( sieve , j + p + l , size , <span class="hljs-number">2</span> * p ) ;

			}

			++i ;

		}

		i = m ;

		<span class="hljs-keyword">for</span> ( ; ; ) {

			<span class="hljs-keyword">if</span> ( i &gt;= size ) {
				<span class="hljs-keyword">break</span> ;
			}

			<span class="hljs-keyword">if</span> ( get( sieve , i ) ) {
				callback( itop23( i ) ) ;
			}

			++i ;


			<span class="hljs-keyword">if</span> ( i &gt;= size ) {
				<span class="hljs-keyword">break</span> ;
			}

			<span class="hljs-keyword">if</span> ( get( sieve , i ) ) {
				callback( itop23( i ) ) ;
			}

			++i ;
		}

		<span class="hljs-keyword">return</span> sieve ;
	} ;

	<span class="hljs-keyword">return</span> eratosthenes23 ;

} ;

exports.__eratosthenes23__ = __eratosthenes23__ ;</div></div></div></div></body></html>